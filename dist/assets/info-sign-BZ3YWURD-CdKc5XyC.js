const __vite__fileDeps=["assets/index-CybJHrkb.js","assets/index-CwMm_7HW.js","assets/index-DiwrgTda.css","assets/index.browser.esm-plakMx9P.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{Y as ie,U as le,a0 as oe,E as ce,m as me,r as m,a1 as o,N as P,M as K,a2 as de,a3 as i,a4 as z,a5 as N,a6 as ue,X as ge,o as a,a7 as ve,B as D,a8 as b,a9 as I,aa as M,ab as F,ac as pe}from"./index-CwMm_7HW.js";import{V as Ee,L as fe,n as he,P as ye,D as Ne,T as _e}from"./index-D1Ya5Kus.js";import{C as we}from"./chunk-B6GOWKTQ-CEK1St30.js";import{x as Te}from"./chunk-U3EMLJZP-DQkL3ChG.js";import{N as Ae}from"./chunk-KGYACALK-DwB-tQk9.js";import{u as Se}from"./useTranslation-L85-XbTB.js";import"./colors-CTsCX3YG.js";import"./chunk-MYQNSXNS-DH2S_xSd.js";import"./index-IuKyp_EY.js";var Ce="ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",ke={async findAssociatedTokenAddress(_,r){let{TOKEN_PROGRAM_ID:l}=await F(()=>import("./index-CybJHrkb.js"),__vite__mapDeps([0,1,2,3])),{PublicKey:v}=await F(async()=>{const{PublicKey:E}=await import("./index.browser.esm-plakMx9P.js").then(t=>t.i);return{PublicKey:E}},__vite__mapDeps([3,1,2]));return v.findProgramAddressSync([new v(_).toBuffer(),l.toBuffer(),new v(r).toBuffer()],new v(Ce))[0]}},q=ke;function Pe(_){let{method:r,param:l,chainId:v,loginAuthorizationSign:E}=_,{t}=Se(),w=ie(),{setPaymentVerify:V,userInfo:d,setPaymentPassword:W}=le(),{events:T}=oe(),{modalOptions:O}=ce(),{authCoreModal:H}=me(),{errorHandle:X}=we(),[R,A]=m.useState(!1),L=Te(),[u,j]=m.useState(),[B,J]=m.useState(),[U,Y]=m.useState(),[Z,f]=m.useState(""),[Q,h]=m.useState(""),{hasSetPaymentPassword:S,showSetPaymentPasswordOrConfirm:ee}=Ee(),g=m.useMemo(()=>({id:v||o.solana.chainId,name:"Solana"}),[]),ae=m.useMemo(()=>{let n=o.solana.selectedAddress;return P(n)},[]);m.useEffect(()=>{K().catch(n=>{}),de()&&w("account/master-password/verify")},[w]);let ne=()=>{K().then(()=>{G()}).catch(n=>{var e;A(!1),L.error((e=n.message)!=null?e:"Sign Error")})},$=(n,e)=>{T.emit("signResponse",{result:n,error:e})};async function x(n,e){if(!e)return[];let s=await Promise.all(e.map(n));return e.filter((p,c)=>s[c])}let G=async()=>{var n,e;!r||(b({record_type:I.PAGE_SIGN_CONFIRM_BUTTON_CLICK}),(n=d==null?void 0:d.security_account)!=null&&n.has_set_payment_password?V({visible:!0,onVerifyCompleted:C}):r===i.signAndSendTransaction||r===i.signTransaction||r===i.signAllTransactions||((e=O==null?void 0:O.promptSettingConfig)==null?void 0:e.promptPaymentPasswordSettingWhenSign)===3?ee(C):C())},C=async()=>{var n;if(!r)return;A(!0);let e;try{if(r===i.signMessage)e=await o.solana.signMessage(l);else if(r===i.signAndSendTransaction)e=await o.solana.signAndSendTransaction(l,g.id);else if(r===i.signTransaction)e=await o.solana.signTransaction(l,g.id);else if(r===i.signAllTransactions)e=await o.solana.signAllTransactions(l,g.id);else throw new Error("Unknown method");b({record_type:I.PAGE_SIGN_CONFIRM_BUTTON_CLICK_SUCCESS})}catch(s){b({record_type:I.PAGE_SIGN_CONFIRM_BUTTON_CLICK_FAILURE}),(s==null?void 0:s.error_code)===50103&&!((n=d==null?void 0:d.security_account)!=null&&n.has_set_payment_password)?ne():(s==null?void 0:s.message)==="Local Key not found"||(s==null?void 0:s.message)==="Master password decryption error"?w("account/master-password/verify"):X(s)}finally{A(!1)}e&&(r===i.signMessage&&E?T.emit("loginSuccess",{...d,authorization:{message:N.encode(l),signature:e}}):$(e))},se=()=>{R||(E?T.emit("loginSuccess",d):$(void 0,pe.userRejectedRequest()))};m.useEffect(()=>{if(r===i.signMessage)f(t("sign.signature_message")),h(t("sign.signature_title"));else if(r===i.signAndSendTransaction){f(t("sign.send_transaction")),h(t("sign.approve_and").format(z(g)));let n=l.serialize({requireAllSignatures:!1,verifySignatures:!1});y([N.encode(n)])}else if(r===i.signTransaction){f(t("sign.sign_transaction")),h(t("sign.sign_but"));let n=l.serialize({requireAllSignatures:!1,verifySignatures:!1});y([N.encode(n)])}else if(r===i.signAllTransactions){f(t("sign.sign_transaction")),h(t("sign.sign_but"));let n=l.map(e=>N.encode(e.serialize({requireAllSignatures:!1,verifySignatures:!1})));y(n)}else throw new Error("Unknown method")},[l]),m.useEffect(()=>{o.solana.connect()},[]);let y=n=>{o.solana.request({chainId:g.id,method:ue.enhancedDeserializeTransaction,params:n}).then(e=>{var s,p;j(e),x(async c=>{let k=await q.findAssociatedTokenAddress(o.solana.selectedAddress,c.mint);return c.associatedTokenAddress===k.toBase58()},(s=e==null?void 0:e.estimatedChanges)==null?void 0:s.nfts).then(c=>{J(c)}),x(async c=>{let k=await q.findAssociatedTokenAddress(o.solana.selectedAddress,c.mint);return c.associatedTokenAddress===k.toBase58()},(p=e==null?void 0:e.estimatedChanges)==null?void 0:p.tokens).then(c=>{Y(c)})}).catch(e=>{var s;ge.error({title:(s=e.message)!=null?s:"Deserialize Transaction Error",okCancel:!0,cancelText:t("common.cancel"),okText:t("common.retry"),wrapClassName:"auth-core-modal-error",getContainer:()=>H.rootBody,onOk:()=>{y(n)}})})},te=()=>{let n=new TextDecoder().decode(l);return a.createElement("div",{className:"sign-message"},a.createElement("div",{className:"message"+(S?"":" no-password-tip")},a.createElement("div",{className:"pre-wrap personal-message"},n)))},re=()=>{var n;return a.createElement(_e,{defaultActiveKey:"1",items:[{label:t("sign.details"),key:"1",children:a.createElement(a.Fragment,null,a.createElement("div",{className:"balance-change"},a.createElement("div",{className:"title"},t("sign.estimated_balance_change")),a.createElement("div",{className:"change-body"},(n=u==null?void 0:u.estimatedChanges)==null?void 0:n.sols.filter(e=>{var s,p;return e.address===((p=(s=o)==null?void 0:s.solana)==null?void 0:p.selectedAddress)}).map((e,s)=>a.createElement("div",{className:"change-title",key:`sol-change-${s}`},"SOL",a.createElement("div",{className:"change-val",style:e.lamportsChange<0?{color:"#ea4335"}:{}},e.lamportsChange<0?"":"+",M(e.lamportsChange,9)))),B==null?void 0:B.map((e,s)=>a.createElement("div",{className:"change-title",key:`nft-change-${s}`},e.name?e.name:"Unknown NFT",a.createElement("div",{className:"change-val",style:e.amountChange<0?{color:"#ea4335"}:{}},e.amountChange<0?"":"+",e.amountChange))),U==null?void 0:U.map((e,s)=>a.createElement("div",{className:"change-title",key:`token-change-${s}`},e.name?e.name:"Unknown Token",a.createElement("div",{className:"change-val",style:e.amountChange<0?{color:"#ea4335"}:{}},e.amountChange<0?"":"+",M(e.amountChange,e.decimals)))))),a.createElement("div",{className:"net-fee solana"},a.createElement("div",{className:"title"},t("sign.network_fee"),u&&a.createElement("div",{className:"fee-val"},M(u.estimatedLamportsFee,9)," SOL"))))},{label:t("sign.data"),key:"2",children:a.createElement("div",null,u==null?void 0:u.instructions.map((e,s)=>a.createElement("div",{className:"inner-instruction",key:`instruction-${s}`},a.createElement("div",{className:"inner-content"},a.createElement("div",{className:"content-item"},a.createElement("div",{className:"item"},a.createElement("div",{className:"item-0"},"#",s+1," - ",t(`program.${e.type}`)),a.createElement("div",{className:"item-1 mt10"},t("sign.program_id"),a.createElement("span",null,P(e.programId))),a.createElement("div",{className:"item-1 mt15"},t("sign.data"),a.createElement("span",null,P(e.data)))))))))}]})};return a.createElement("div",{className:"info-sign"},a.createElement("style",null,fe),!S&&a.createElement("div",{className:"has-payment-password"},a.createElement("div",{className:"has-payment-password-icon"}),a.createElement("div",{className:"has-payment-password-tip"},t("account.waring_tip1")),a.createElement("div",{className:"has-payment-password-set",onClick:W},t("account.set"))),a.createElement("div",{className:"scroll-part"+(S?"":" no-password-tip")},a.createElement(he,{userInfo:d,transactionInfo:u}),a.createElement("div",{className:"info-request"},Z),a.createElement("div",{className:"info-title"},a.createElement("img",{src:ve(g),alt:""}),z(g)),a.createElement(ye,{text:o.solana.selectedAddress,onCopy:()=>L.success(t("new.copied_to"))},a.createElement("div",{className:"info-address"},ae,a.createElement("div",{className:"copy-icon"},a.createElement(Ne,null)))),a.createElement("div",{className:"info-des"},Q),a.createElement("div",{className:"apart-line"}),r===i.signMessage&&te(),r!==i.signMessage&&re()),a.createElement("div",{className:"btn-box"},a.createElement("div",null,a.createElement(D,{className:"btn-cancel",onClick:se},t("common.cancel")),a.createElement(D,{className:"btn-approve",onClick:G,loading:R},t("common.confirm"))),a.createElement(Ae,null)))}var xe=Pe;export{xe as default};
